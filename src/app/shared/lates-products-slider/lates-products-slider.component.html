<!-- Latest Products Slider Section -->
<section
  class="latest-products-section"
  dir="rtl"
  aria-labelledby="latest-products-title"
>
  <div class="latest-products-container">

    <!-- Section Header -->
    <div class="section-header">

      <!-- Section Title with Border Accent -->
      <h2
        id="latest-products-title"
        class="section-title"
      >
        {{ sectionTitle }}
      </h2>

      <!-- Navigation Controls -->
      <div class="nav-controls" role="group" aria-label="التحكم في العرض">

        <!-- Previous Button (Right in RTL) -->
        <button
          class="nav-button nav-button-prev"
          (click)="prevSlide()"
          [disabled]="isTransitioning() || isLoading()"
          aria-label="المنتجات السابقة"
          type="button"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </button>

        <!-- Next Button (Left in RTL) -->
        <button
          class="nav-button nav-button-next"
          (click)="nextSlide()"
          [disabled]="isTransitioning() || isLoading()"
          aria-label="المنتجات التالية"
          type="button"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="m15 18-6-6 6-6"></path>
          </svg>
        </button>

      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">جاري تحميل المنتجات...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading() && products.length === 0" class="empty-state">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="64"
        height="64"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="empty-icon"
      >
        <circle cx="8" cy="21" r="1"></circle>
        <circle cx="19" cy="21" r="1"></circle>
        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>
      </svg>
      <p class="empty-text">لا توجد منتجات متاحة حالياً</p>
      <button class="retry-button" (click)="refreshProducts()">
        إعادة المحاولة
      </button>
    </div>

    <!-- Products Scroll Container -->
    <div
      *ngIf="!isLoading() && products.length > 0"
      class="products-scroll-container"
      role="region"
      aria-label="أحدث المنتجات"
    >

      <!-- Product Card -->
      <div
        *ngFor="let product of products; trackBy: trackByProductId"
        class="product-card"
      >
        <!-- Image Container -->
        <div
          class="product-image-container"
          (mouseenter)="startImageSlider(product.id)"
          (mouseleave)="stopImageSlider(product.id)"
          (touchstart)="onTouchStart($event, product.id)"
          (touchmove)="onTouchMove($event, product.id)"
          (touchend)="onTouchEnd(product.id)"
        >
          <!-- Image Slider -->
          <div class="image-slider">
            <img
              [src]="getCurrentImage(product).url"
              [alt]="getCurrentImage(product).alt"
              class="product-image"
              loading="lazy"
            />
          </div>

          <!-- Offer Badge -->
          <div class="offer-badge" *ngIf="product.offer?.enabled">
            <i class="bi bi-tag-fill"></i>
            -{{ product.offer?.discountPercentage }}%
          </div>

          <!-- Desktop Hover Overlay -->
          <div class="image-overlay desktop-only">
            <button
              class="action-btn add-to-cart-btn"
              title="إضافة إلى السلة"
              (click)="addToCart($event, product)"
              [disabled]="!product.inStock || isAddingToCart(product.id)"
            >
              <i class="bi bi-cart-plus" *ngIf="!isAddingToCart(product.id)"></i>
              <i class="bi bi-hourglass-split" *ngIf="isAddingToCart(product.id)"></i>
            </button>

            <button
              class="action-btn details-btn"
              title="عرض التفاصيل"
              (click)="$event.stopPropagation(); viewProductDetails(product)"
            >
              <i class="bi bi-eye"></i>
            </button>
          </div>

          <!-- Image Counter & Dots -->
          <div class="image-navigation" *ngIf="product.images && product.images.length > 1">
            <div class="image-dots">
              <span
                *ngFor="let img of product.images; let i = index"
                class="dot"
                [class.active]="i === getCurrentImageIndex(product.id)"
              ></span>
            </div>
          </div>
        </div>

        <!-- Product Info -->
        <div class="product-info" (click)="viewProductDetails(product)">
          <span class="product-category">
            <i class="bi bi-bookmark"></i>
            {{ product.category }}
          </span>
          <h3 class="product-name">{{ product.name }}</h3>
          <p class="product-description">{{ product.description }}</p>

          <div class="product-footer">
            <div class="price-container">
              <span class="product-price" *ngIf="!product.offer?.enabled">
                {{ formatPrice(product.price) }}
              </span>
              <div class="price-with-offer" *ngIf="product.offer?.enabled">
                <span class="original-price">{{ formatPrice(product.price) }}</span>
                <span class="final-price">{{ formatPrice(product.finalPrice || product.price) }}</span>
              </div>
            </div>
            <span class="stock-badge" [class.in-stock]="product.inStock">
              <i [class]="product.inStock ? 'bi bi-check-circle-fill' : 'bi bi-x-circle-fill'"></i>
              {{ product.inStock ? 'متوفر' : 'غير متوفر' }}
            </span>
          </div>
        </div>

        <!-- Mobile Action Buttons -->
        <div class="mobile-actions">
          <button
            class="mobile-action-btn cart-btn"
            (click)="addToCart($event, product)"
            [disabled]="!product.inStock || isAddingToCart(product.id)"
          >
            <i class="bi bi-cart-plus" *ngIf="!isAddingToCart(product.id)"></i>
            <i class="bi bi-hourglass-split" *ngIf="isAddingToCart(product.id)"></i>
            <span>{{ isAddingToCart(product.id) ? 'جاري الإضافة...' : 'أضف للسلة' }}</span>
          </button>
          <button
            class="mobile-action-btn view-btn"
            (click)="viewProductDetails(product)"
          >
            <i class="bi bi-eye"></i>
            <span>عرض التفاصيل</span>
          </button>
        </div>
      </div>

    </div>

  </div>
</section>
