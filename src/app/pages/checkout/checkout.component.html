<!-- src/app/features/checkout/checkout.component.html -->
<main class="checkout-page">
  <div class="container">
    <!-- Back Button -->
    <button class="back-btn" (click)="goBackToCart()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      <span>العودة إلى السلة</span>
    </button>

    <h1 class="page-title">إتمام الطلب</h1>

    <!-- Loading State -->
    <div *ngIf="isSubmitting" class="loading-overlay">
      <div class="spinner"></div>
      <p>جاري إنشاء الطلب...</p>
    </div>

    <!-- Confirmation Modal -->
    <div *ngIf="confirmationModal.show" class="modal-overlay" (click)="closeConfirmation()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">{{ confirmationModal.title }}</h3>
          <button class="modal-close" (click)="closeConfirmation()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="modal-body">
          <p class="modal-message">{{ confirmationModal.message }}</p>
        </div>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-cancel" (click)="closeConfirmation()">
            {{ confirmationModal.cancelText }}
          </button>
          <button class="modal-btn modal-btn-confirm" (click)="confirmAction()">
            {{ confirmationModal.confirmText }}
          </button>
        </div>
      </div>
    </div>

    <div class="checkout-grid">
      <!-- Shipping Form Section -->
      <div class="shipping-section">
        <div class="form-card">
          <h3 class="form-title">بيانات الشحن</h3>

          <form (ngSubmit)="onSubmit()" #checkoutForm="ngForm" class="shipping-form">
            <!-- Full Name -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-person"></i>
                الاسم الكامل *
              </label>
              <input
                type="text"
                [(ngModel)]="shippingData.name"
                name="name"
                required
                placeholder="أدخل اسمك الكامل"
                class="form-input"
                [disabled]="isSubmitting">
            </div>

            <!-- Phone -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-phone"></i>
                رقم الهاتف *
              </label>
              <input
                type="tel"
                [(ngModel)]="shippingData.phone"
                name="phone"
                required
                placeholder="01xxxxxxxxx"
                dir="ltr"
                maxlength="11"
                class="form-input"
                [disabled]="isSubmitting">
              <small class="form-hint">مثال: 01012345678</small>
            </div>

            <!-- Email (Optional) -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-envelope"></i>
                البريد الإلكتروني (اختياري)
              </label>
              <input
                type="email"
                [(ngModel)]="shippingData.email"
                name="email"
                placeholder="example@email.com"
                dir="ltr"
                class="form-input"
                [disabled]="isSubmitting">
            </div>

            <!-- Governorate -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-geo-alt"></i>
                المحافظة *
              </label>
              <select
                [(ngModel)]="shippingData.governorate"
                name="governorate"
                required
                class="form-select"
                [disabled]="isSubmitting">
                <option *ngFor="let gov of governorates" [value]="gov">
                  {{ gov }}
                </option>
              </select>
            </div>

            <!-- Address -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-house"></i>
                العنوان بالتفصيل *
              </label>
              <textarea
                [(ngModel)]="shippingData.address"
                name="address"
                required
                rows="3"
                placeholder="الشارع، المنطقة، معالم قريبة..."
                class="form-textarea"
                [disabled]="isSubmitting"></textarea>
            </div>

            <!-- Notes (Optional) -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-chat-left-text"></i>
                ملاحظات إضافية (اختياري)
              </label>
              <textarea
                [(ngModel)]="shippingData.notes"
                name="notes"
                rows="2"
                placeholder="أي ملاحظات أو طلبات خاصة..."
                class="form-textarea"
                [disabled]="isSubmitting"></textarea>
            </div>

            <!-- Payment Method Selection -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-credit-card"></i>
                طريقة الدفع *
              </label>
              <div class="payment-methods">
                <div
                  *ngFor="let method of paymentMethods"
                  class="payment-method"
                  [class.selected]="shippingData.paymentMethod === method.value"
                  (click)="selectPaymentMethod(method.value)">
                  <div class="payment-method-header">
                    <i [class]="method.icon"></i>
                    <span class="payment-method-label">{{ method.label }}</span>
                    <div class="payment-radio">
                      <input
                        type="radio"
                        [id]="method.value"
                        name="paymentMethod"
                        [value]="method.value"
                        [(ngModel)]="shippingData.paymentMethod"
                        [disabled]="isSubmitting">
                      <span class="radio-checkmark"></span>
                    </div>
                  </div>
                  <p class="payment-method-description">{{ method.description }}</p>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              [disabled]="!checkoutForm.form.valid || isSubmitting || orderItems.length === 0"
              class="submit-btn">
              <span *ngIf="!isSubmitting">
                <i class="bi bi-check-circle"></i>
                تأكيد الطلب
              </span>
              <span *ngIf="isSubmitting">
                <i class="bi bi-hourglass-split"></i>
                جاري الإرسال...
              </span>
            </button>

            <!-- Payment Info -->
            <div class="payment-info">
              <i class="bi bi-info-circle"></i>
              <p *ngIf="shippingData.paymentMethod === 'cash'">سيتم الدفع عند الاستلام</p>
              <p *ngIf="shippingData.paymentMethod === 'instapay'">سيتم التواصل معك لإكمال الدفع عبر إنستاباي</p>
              <p *ngIf="shippingData.paymentMethod === 'vodafonecash'">سيتم التواصل معك لإكمال الدفع عبر فودافون كاش</p>
            </div>
          </form>
        </div>
      </div>

      <!-- Order Summary Section -->
      <div class="summary-section">
        <div class="summary-card">
          <h3 class="summary-title">
            <i class="bi bi-cart-check"></i>
            ملخص الطلب
          </h3>

          <!-- Items Count -->
          <div class="items-count-badge">
            <i class="bi bi-box-seam"></i>
            <span>{{ itemCount }} منتج</span>
          </div>

          <!-- Items List -->
          <div class="items-list">
            <div *ngFor="let item of orderItems" class="order-item">
              <img
                [src]="item.image || 'assets/images/placeholder.jpg'"
                [alt]="item.name || 'Product'"
                class="item-image">

              <div class="item-info">
                <h4 class="item-name">{{ item.name || 'منتج' }}</h4>
                <p class="item-quantity">الكمية: {{ item.quantity }}</p>
              </div>

              <span class="item-price">{{ (item.price * item.quantity) | number: '1.0-0' }} ج.م</span>
            </div>
          </div>

          <!-- Summary Footer -->
          <div class="summary-footer">
            <div class="summary-row">
              <span>المجموع الفرعي</span>
              <span>{{ totalAmount | number: '1.0-0' }} ج.م</span>
            </div>
            <div class="summary-row">
              <span>الشحن</span>
              <span>يحدد عند التأكيد</span>
            </div>

            <div class="total-row">
              <span>الإجمالي الكلي</span>
              <span class="total-amount">{{ totalAmount | number: '1.0-0' }} ج.م</span>
            </div>

            <div class="payment-note">
              <i class="bi bi-shield-check"></i>
              <p>جميع طرق الدفع آمنة ومضمونة</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
