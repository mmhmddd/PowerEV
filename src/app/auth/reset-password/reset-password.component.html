<div class="reset-container">
  <!-- Background decoration -->
  <div class="reset-bg">
    <div class="reset-bg__circle reset-bg__circle--1"></div>
    <div class="reset-bg__circle reset-bg__circle--2"></div>
    <div class="reset-bg__circle reset-bg__circle--3"></div>
  </div>

  <!-- Reset Password Card -->
  <div class="reset-card">
    <!-- Logo and Header -->
    <div class="reset-header">
      <div class="reset-logo">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
      </div>
      <h1 class="reset-title">Power EV</h1>
    </div>

    <!-- Loading State (Checking Token) -->
    <div class="loading-container" *ngIf="tokenChecking">
      <div class="spinner-large">
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
        </svg>
      </div>
      <p>جاري التحقق من الرابط...</p>
    </div>

    <!-- Invalid Token -->
    <div class="invalid-token" *ngIf="!tokenChecking && !tokenValid">
      <div class="invalid-token__icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
      </div>
      <h2>رابط غير صحيح</h2>
      <p>{{ error || 'الرابط منتهي الصلاحية أو غير صحيح. يرجى طلب رابط جديد.' }}</p>
      <button class="btn btn--primary btn--block" (click)="goToLogin()">
        العودة لتسجيل الدخول
      </button>
    </div>

    <!-- Success State -->
    <div class="success-container" *ngIf="resetSuccess && !tokenChecking">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      </div>
      <h2>تم بنجاح!</h2>
      <p>تم إعادة تعيين كلمة المرور بنجاح</p>
      <p class="redirect-text">جاري تحويلك لتسجيل الدخول...</p>
    </div>

    <!-- Reset Password Form -->
    <div *ngIf="!tokenChecking && tokenValid && !resetSuccess">
      <div class="reset-info">
        <div class="reset-info__icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
        </div>
        <h2 class="reset-info__title">إعادة تعيين كلمة المرور</h2>
        <p class="reset-info__description">
          يرجى إدخال كلمة المرور الجديدة
        </p>
      </div>

      <!-- Error Alert -->
      <div class="alert alert--error" *ngIf="error">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>{{ error }}</span>
        <button class="alert__close" (click)="clearError()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <!-- Form -->
      <form class="reset-form" (ngSubmit)="onSubmit()">
        <!-- New Password Field -->
        <div class="form-group">
          <label class="form-label">كلمة المرور الجديدة</label>
          <div class="input-wrapper" [class.input-wrapper--error]="fieldErrors.password">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <input
              [type]="showPassword ? 'text' : 'password'"
              class="form-input"
              [(ngModel)]="password"
              name="password"
              placeholder="أدخل كلمة المرور الجديدة (6 أحرف على الأقل)"
              [class.form-input--error]="fieldErrors.password"
              (input)="clearError()"
              autocomplete="new-password"
              required
            >
            <button
              type="button"
              class="password-toggle"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="showPassword ? 'إخفاء كلمة المرور' : 'إظهار كلمة المرور'"
            >
              <svg *ngIf="!showPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg *ngIf="showPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
          <span class="form-error" *ngIf="fieldErrors.password">{{ fieldErrors.password }}</span>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label class="form-label">تأكيد كلمة المرور</label>
          <div class="input-wrapper" [class.input-wrapper--error]="fieldErrors.confirmPassword">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              class="form-input"
              [(ngModel)]="confirmPassword"
              name="confirmPassword"
              placeholder="أعد إدخال كلمة المرور"
              [class.form-input--error]="fieldErrors.confirmPassword"
              (input)="clearError()"
              autocomplete="new-password"
              required
            >
            <button
              type="button"
              class="password-toggle"
              (click)="toggleConfirmPasswordVisibility()"
              [attr.aria-label]="showConfirmPassword ? 'إخفاء كلمة المرور' : 'إظهار كلمة المرور'"
            >
              <svg *ngIf="!showConfirmPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg *ngIf="showConfirmPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
          <span class="form-error" *ngIf="fieldErrors.confirmPassword">{{ fieldErrors.confirmPassword }}</span>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements">
          <p class="requirements-title">متطلبات كلمة المرور:</p>
          <ul class="requirements-list">
            <li [class.met]="password.length >= 6">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              <span>6 أحرف على الأقل</span>
            </li>
            <li [class.met]="password && confirmPassword && password === confirmPassword">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              <span>تطابق كلمة المرور</span>
            </li>
          </ul>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="btn btn--primary btn--block"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">إعادة تعيين كلمة المرور</span>
          <span *ngIf="isLoading" class="loading-text">
            <svg class="spinner" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
            </svg>
            جاري إعادة التعيين...
          </span>
        </button>

        <!-- Back to Login -->
        <button
          type="button"
          class="btn btn--secondary btn--block"
          (click)="goToLogin()"
          [disabled]="isLoading"
        >
          العودة لتسجيل الدخول
        </button>
      </form>
    </div>

    <!-- Footer -->
    <div class="reset-footer">
      <p>© 2024 Power EV. جميع الحقوق محفوظة</p>
    </div>
  </div>
</div>
